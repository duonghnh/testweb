<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="utf-8" />
  <title>Demo01: duong</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link href="css/app.css" rel="stylesheet" />
  <script src="scripts/jquery.js"></script>
  <script src="scripts/powerbi.min.js"></script>
</head>

<body>

  <div id="embedContainer" />

  <script>

    // data required for embedding Power BI report
    var embedReportId = "c1b73308-ecd9-46ae-9e3b-b9b5e58b1a7f";
    var embedUrl = "https://app.powerbi.com/reportEmbed";
    var accessToken = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IlQxU3QtZExUdnlXUmd4Ql82NzZ1OGtyWFMtSSIsImtpZCI6IlQxU3QtZExUdnlXUmd4Ql82NzZ1OGtyWFMtSSJ9.eyJhdWQiOiJodHRwczovL2FuYWx5c2lzLndpbmRvd3MubmV0L3Bvd2VyYmkvYXBpIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvMjQ3YTEwOTctODg5My00YzMzLThmYTctMjNmMzJhOGI3MjYyLyIsImlhdCI6MTcwMTgxMDM4NywibmJmIjoxNzAxODEwMzg3LCJleHAiOjE3MDE4MTU2NTUsImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJBVFFBeS84VkFBQUFTRTBxalVzNmRhYk1DRVExL0xnbFk2Sy9SNE9TOEM0UE1Qd005WTJYWkI0THFuNHNiS1pONDlpeFlNTHFhc0JWIiwiYW1yIjpbInB3ZCJdLCJhcHBpZCI6Ijg3MWMwMTBmLTVlNjEtNGZiMS04M2FjLTk4NjEwYTdlOTExMCIsImFwcGlkYWNyIjoiMCIsImZhbWlseV9uYW1lIjoiQW5hbHl0aWNzIiwiZ2l2ZW5fbmFtZSI6IlJFNDAiLCJpcGFkZHIiOiIzNC4xMjIuMTUzLjI1MCIsIm5hbWUiOiJSRTQwIEFuYWx5dGljcyIsIm9pZCI6IjMyYmQwNjY1LTJjYTQtNDA5ZC1iZjc4LWQwYmFkMzQ3M2VmZCIsInB1aWQiOiIxMDAzMjAwMUZEMzI0QTE1IiwicmgiOiIwLkFYWUFseEI2SkpPSU0weVBweVB6S290eVlna0FBQUFBQUFBQXdBQUFBQUFBQUFDWkFDMC4iLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzaWduaW5fc3RhdGUiOlsia21zaSJdLCJzdWIiOiItRll4ckVwSnpodkliLXltRUxQTHhGT0pqMHFQSDhDaC1QTGVuNmpJSXFzIiwidGlkIjoiMjQ3YTEwOTctODg5My00YzMzLThmYTctMjNmMzJhOGI3MjYyIiwidW5pcXVlX25hbWUiOiJhbmFseXRpY3NAcmU0MC5jby5ueiIsInVwbiI6ImFuYWx5dGljc0ByZTQwLmNvLm56IiwidXRpIjoiSFRDSGdQd2dOVU81QXY5dlBxTmdBQSIsInZlciI6IjEuMCIsIndpZHMiOlsiNjJlOTAzOTQtNjlmNS00MjM3LTkxOTAtMDEyMTc3MTQ1ZTEwIiwiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il0sInhtc19wbCI6ImVuLVVTIn0.IXIRVS15HiintslNa9TU-0-q0czjSV6XVrZrf4zLgq6T2zbOKhLggCW1Ne0DcjWbyp5WBs7rsI72NvdZeqnWWXHnsslAnXEKsvpKvAELOeopBKZSY24foDIARXQwr16Q9iWVCjeiEGWl39VXzHRD24LdlnFY1UbcI7tuFRWoYugmE79vjPLKLoZO9a832IfsBde9S0BGvZCYUYuU3sZjtpstcqQsKUORsWpDQ0hZZIDf-Izc4cgD_IRW7frh43iGM8ZyImjn_v2A2VZ-a-c3pR6dr89A9dOB4WfU5NhuMaKpj-JcND-m_UUxodtEBpSgWCENP-slJMGjBUK5rwW3eg"
	    var models = window['powerbi-client'].models;
    var webhookUrl = 'https://webhook.site/ca4dc469-7324-4826-9976-22e2df3e8668'

    var config = {
      type: 'report',
      id: embedReportId,
      embedUrl: embedUrl,
      accessToken: accessToken,
      tokenType: models.TokenType.Aad
    };
//     var config = {
//   type: 'report',
//   id: embedReportId,
//   embedUrl: embedUrl,
//   accessToken: accessToken,
//   tokenType: models.TokenType.Embed,
//   settings: {
//     filterPaneEnabled: false,
//     navContentPaneEnabled: false
//   },
//   permissions: models.Permissions.All,
//   viewMode: models.ViewMode.View,
//   iframe: document.getElementById('embedContainer')
// };


    // Get a reference to the embedded report HTML element
    var reportContainer = document.getElementById('embedContainer');

    // Embed the report and display it within the div container.
     var report = powerbi.embed(reportContainer, config);
    
    // Display Report object in browser console window
    console.log(report);

    // code to resize the reportContainer to the size of the hosting browser window.
    $(function () {
      var widthBuffer = 12;
      var heightBuffer = 12;
      $("#embedContainer").height($(window).height() - (heightBuffer));
      $("#embedContainer").width($(window).width() - widthBuffer);
      $(window).resize(function () {
        $("#embedContainer").height($(window).height() - (heightBuffer));
        $("#embedContainer").width($(window).width() - widthBuffer);
      });
    });
	
    var scriptTag = document.createElement('script');
    scriptTag.innerHTML = "(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZFBZQ7M');";

     document.head.appendChild(scriptTag);
    var scriptTag2 = document.createElement('script');
    scriptTag2.innerHTML = '(<!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PZFBZQ7M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->);';

     document.body.appendChild(scriptTag2);
report.off("dataSelected");

// report.on will add an event listener.
report.on("dataSelected", function (event) {
    let data = event.detail;
    fetch(webhookUrl)
    console.log("Event - dataSelected:\n", data);
	dataLayer.push({
	  event: "form_submit",
	  eventModel: {
	    // ... (other properties)
	    form_submit_text: data,
	    // ... (other properties)
	  },
	  // ... (other properties)
	})
});
	  
  </script>
</body>
</html>
